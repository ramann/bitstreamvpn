create table users
(
	username varchar(30) not null
		constraint users_pkey
			primary key,
	password varchar(64) not null,
	salt varchar(16) not null
)
;

create table product
(
	product_id serial not null
		constraint product_pkey
			primary key,
	title varchar(40) not null,
	descr varchar(128) not null,
	price numeric(5,2) not null,
	count_avail integer not null
)
;

create table purchase
(
	id serial not null
		constraint purchase_pkey
			primary key,
	username varchar(30) not null
		constraint fki710t1bklbvtdta4ch2xbmm8v
			references users
		constraint purchase_username_fkey
			references users,
	date_initiated timestamp not null,
	amount numeric(11,8) not null,
	receiving_address varchar(40) not null,
	date_confirm_1 timestamp,
	date_confirm_3 timestamp,
	date_confirm_6 timestamp
)
;

create table certificate
(
	id serial not null
		constraint certificate_pkey
			primary key,
	purchase_id serial not null
		constraint certificate_purchase_id_fkey
			references purchase
		constraint fkfx6qiece314rp7ap5ut44d16v
			references purchase,
	date_initiated timestamp not null,
	csr_text varchar(4096) not null,
	signed boolean not null,
	cert_text varchar(4096),
	revoked boolean,
	serial bigint
)
;


